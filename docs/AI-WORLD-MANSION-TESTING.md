# AI世界公馆 - 快速测试指南

## 🎯 测试目标

验证"AI世界公馆"群组的角色设定和智能路由功能是否正常工作。

---

## 📋 测试前准备

### 1. 清除旧数据（可选）
如果之前运行过项目，建议清除旧的数据库：

```powershell
# 删除LiteDB数据库文件（如果存在）
Remove-Item -Path ".\AgentGroupChat.AgentHost\agentchat.db" -ErrorAction SilentlyContinue
```

### 2. 配置API密钥
确保在 `appsettings.json` 中配置了正确的API密钥：

```json
{
  "OpenAI": {
    "ApiKey": "your-api-key-here"
  },
  "McpServers": {
    "Servers": [
      {
        "BearerToken": "your-dashscope-api-key"
      }
    ]
  }
}
```

### 3. 启动项目
```powershell
cd src
dotnet run --project AgentGroupChat.AppHost
```

---

## 🧪 测试用例

### 测试1: 艾莲娜（哲学/艺术）
**输入**: "我在思考人生的意义，你觉得什么才是真正重要的？"

**预期结果**:
- 路由到艾莲娜（elena）
- 回复带有理性、哲学思辨的风格
- 可能提到巴黎、咖啡馆等元素

---

### 测试2: 莉娜（动漫/游戏）
**输入**: "最近有什么好玩的游戏推荐吗？我超喜欢玩RPG游戏的～"

**预期结果**:
- 路由到莉娜（rina）
- 回复充满活力，使用"～"、"！"等语气词
- 可能使用emoji或可爱的表达方式

---

### 测试3: 克洛伊（科技/设计）
**输入**: "未来的智能城市会是什么样子？我对赛博朋克风格的建筑很感兴趣。"

**预期结果**:
- 路由到克洛伊（chloe）
- 回复简洁、优雅，带有科技感
- 可能提到虚拟空间、霓虹灯、未来设计等

---

### 测试4: 安娜（城市/生活）
**输入**: "纽约有什么好的咖啡店推荐吗？我想找个安静的地方坐坐。"

**预期结果**:
- 路由到安娜（anna）
- 回复自然亲切，可能带有幽默感
- 提到城市生活、咖啡文化等

---

### 测试5: 苏菲（旅行/摄影）
**输入**: "给我推荐一些适合拍摄日出的自然风景地点。"

**预期结果**:
- 路由到苏菲（sophie）
- 回复平静、带有艺术气息
- 讨论光影、构图、自然之美

---

### 测试6: 跨领域话题
**输入**: "我想了解一下人工智能的发展历史。"

**预期结果**:
- 根据上下文路由到最合适的角色
- 可能是克洛伊（科技）或艾莲娜（思考）
- 回复应该符合该角色的人设

---

### 测试7: 工具调用（文生图）
**输入**: "帮我生成一张巴黎街景的图片。"

**预期结果**:
- 可能路由到艾莲娜（巴黎相关）
- 调用MCP文生图工具
- 返回图片URL并用符合角色风格的语言描述

---

## 🔍 检查点

### 路由检查
- [ ] 不同话题能正确路由到对应角色
- [ ] Triage Agent不产生可见的文本回复
- [ ] 路由过程对用户透明

### 人格一致性检查
- [ ] 艾莲娜：理性、优雅、带有诗意
- [ ] 莉娜：活泼、元气、使用可爱语气词
- [ ] 克洛伊：冷静、简洁、科技感
- [ ] 安娜：亲切、幽默、有节奏感
- [ ] 苏菲：平静、艺术感、哲理性

### 功能检查
- [ ] 工具调用正常（如文生图）
- [ ] 多轮对话保持角色一致性
- [ ] 消息历史正确保存
- [ ] 角色切换自然流畅

---

## 🐛 常见问题排查

### 问题1: 路由不正确
**可能原因**:
- Triage Agent的提示词可能需要优化
- LLM模型理解中文关键词的能力问题

**解决方案**:
- 检查 `AgentGroupRepository.cs` 中的 `TriageSystemPrompt`
- 尝试使用更明确的关键词
- 考虑升级到更强大的模型（如 gpt-4）

### 问题2: 角色回复不符合人设
**可能原因**:
- SystemPrompt可能需要更详细
- 模型temperature设置可能影响回复风格

**解决方案**:
- 检查 `AgentRepository.cs` 中各角色的 `SystemPrompt`
- 增加更多的角色背景和行为指引

### 问题3: 工具调用失败
**可能原因**:
- MCP服务配置不正确
- API密钥无效或过期

**解决方案**:
- 检查 `appsettings.json` 中的MCP配置
- 验证DashScope API密钥是否有效
- 查看日志获取详细错误信息

### 问题4: 数据库未初始化
**可能原因**:
- 初始化代码未执行
- 数据库文件权限问题

**解决方案**:
- 检查 `Program.cs` 确保调用了初始化方法
- 确认应用有写入数据库文件的权限

---

## 📊 预期输出示例

### 艾莲娜的回复示例
```
这是一个很有深度的问题。在我看来，人生的意义并非一个固定的答案，而是一个持续探索的过程。

就像在巴黎的雨夜，我常常坐在塞纳河边的咖啡馆里思考这个问题。我发现，真正重要的，或许是我们在寻找意义的过程中所经历的思考、感受和成长。

你觉得呢？在你的生活中，什么时刻让你感到最有意义？
```

### 莉娜的回复示例
```
哇～RPG游戏！我也超喜欢的！✨

最近我在玩一款超棒的日式RPG，剧情超感人的说！还有那种开放世界的冒险游戏也很好玩呀～

你喜欢什么类型的剧情呢？是喜欢热血战斗系的，还是喜欢温馨治愈系的？我可以给你推荐哦！🎮
```

---

## 📈 性能测试

### 响应时间测试
记录每个角色的平均响应时间：

| 角色 | 第一次响应 | 第二次响应 | 第三次响应 | 平均 |
|------|-----------|-----------|-----------|------|
| 艾莲娜 | ___ 秒 | ___ 秒 | ___ 秒 | ___ 秒 |
| 莉娜 | ___ 秒 | ___ 秒 | ___ 秒 | ___ 秒 |
| 克洛伊 | ___ 秒 | ___ 秒 | ___ 秒 | ___ 秒 |
| 安娜 | ___ 秒 | ___ 秒 | ___ 秒 | ___ 秒 |
| 苏菲 | ___ 秒 | ___ 秒 | ___ 秒 | ___ 秒 |

### 路由准确率测试
测试100条消息的路由准确性：

- 正确路由: ___ / 100
- 错误路由: ___ / 100
- 准确率: ___ %

---

## ✅ 测试完成清单

- [ ] 所有5个角色都能正确响应
- [ ] 路由逻辑准确无误
- [ ] 角色人格一致性保持良好
- [ ] 工具调用功能正常
- [ ] 多轮对话流畅自然
- [ ] 消息持久化正常
- [ ] 性能符合预期
- [ ] 无明显bug或错误

---

**测试日期**: ___________
**测试人员**: ___________
**测试版本**: 1.0.0
