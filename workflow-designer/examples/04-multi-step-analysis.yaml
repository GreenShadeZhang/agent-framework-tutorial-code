# å¤šæ­¥éª¤åˆ†æå·¥ä½œæµç¤ºä¾‹
# å¤æ‚çš„é¡ºåºå¤„ç†æµç¨‹
kind: Workflow
metadata:
  name: multi_step_analysis_workflow
  version: "1.0"
  description: å¤šæ­¥éª¤æ•°æ®åˆ†æå·¥ä½œæµï¼Œä¾æ¬¡è¿›è¡Œæ•°æ®æ”¶é›†ã€åˆ†æã€å¯è§†åŒ–å»ºè®®å’ŒæŠ¥å‘Šç”Ÿæˆ

variables:
  - name: DataSource
    scope: Local
    type: string
  - name: AnalysisType
    scope: Local
    type: string
  - name: RawData
    scope: Local
    type: string
  - name: CleanedData
    scope: Local
    type: string
  - name: AnalysisResult
    scope: Local
    type: string
  - name: Visualization
    scope: Local
    type: string
  - name: FinalReport
    scope: Local
    type: string

executors:
  # Step 1: æ”¶é›†éœ€æ±‚
  - id: collect_requirements
    type: SendActivity
    properties:
      activity:
        type: message
        text: |
          ğŸ“Š æ¬¢è¿ä½¿ç”¨æ™ºèƒ½æ•°æ®åˆ†æåŠ©æ‰‹ï¼
          æˆ‘å°†å¸®æ‚¨å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š
          1ï¸âƒ£ æ•°æ®æ”¶é›†ä¸æ¸…æ´—
          2ï¸âƒ£ æ•°æ®åˆ†æ
          3ï¸âƒ£ å¯è§†åŒ–å»ºè®®
          4ï¸âƒ£ æŠ¥å‘Šç”Ÿæˆ
    edges:
      - targetId: get_data_source

  - id: get_data_source
    type: Question
    properties:
      prompt: "è¯·æè¿°æ‚¨çš„æ•°æ®æ¥æºå’Œæ•°æ®å†…å®¹ï¼ˆä¾‹å¦‚ï¼šé”€å”®æ•°æ®ã€ç”¨æˆ·è¡Œä¸ºæ•°æ®ç­‰ï¼‰ï¼š"
      variable: Local.DataSource
    edges:
      - targetId: get_analysis_type

  - id: get_analysis_type
    type: Question
    properties:
      prompt: "è¯·é€‰æ‹©åˆ†æç±»å‹ï¼š\n1. è¶‹åŠ¿åˆ†æ\n2. å¯¹æ¯”åˆ†æ\n3. é¢„æµ‹åˆ†æ\n4. ç»¼åˆåˆ†æ"
      variable: Local.AnalysisType
    edges:
      - targetId: simulate_data

  # Step 2: æ¨¡æ‹Ÿæ•°æ®æ”¶é›†
  - id: simulate_data
    type: InvokeAzureAgent
    properties:
      agentId: data_collector
      instructions: |
        ä½ æ˜¯ä¸€ä¸ªæ•°æ®æ¨¡æ‹Ÿä¸“å®¶ã€‚
        æ ¹æ®ç”¨æˆ·æè¿°çš„æ•°æ®æºï¼Œç”Ÿæˆä¸€ç»„æ¨¡æ‹Ÿçš„ç¤ºä¾‹æ•°æ®ã€‚
        
        æ•°æ®æºæè¿°ï¼š${Local.DataSource}
        
        è¯·ç”Ÿæˆä¸€ä¸ªåŒ…å«10-15æ¡è®°å½•çš„æ•°æ®è¡¨æ ¼ï¼ˆä½¿ç”¨Markdownæ ¼å¼ï¼‰ã€‚
        æ•°æ®åº”è¯¥çœ‹èµ·æ¥çœŸå®ä¸”æœ‰åˆ†æä»·å€¼ã€‚
      message: ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
      result: Local.RawData
    edges:
      - targetId: show_raw_data

  - id: show_raw_data
    type: SendActivity
    properties:
      activity:
        type: message
        text: |
          ğŸ“¥ Step 1/4 - æ•°æ®æ”¶é›†å®Œæˆ
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          ${Local.RawData}
    edges:
      - targetId: clean_data

  # Step 3: æ•°æ®æ¸…æ´—
  - id: clean_data
    type: InvokeAzureAgent
    properties:
      agentId: data_cleaner
      instructions: |
        ä½ æ˜¯ä¸€ä¸ªæ•°æ®æ¸…æ´—ä¸“å®¶ã€‚
        
        è¯·å¯¹ä»¥ä¸‹æ•°æ®è¿›è¡Œæ¸…æ´—å¤„ç†ï¼š
        ${Local.RawData}
        
        æ¸…æ´—æ­¥éª¤ï¼š
        1. æ£€æŸ¥å¹¶å¤„ç†ç¼ºå¤±å€¼
        2. è¯†åˆ«å¹¶å¤„ç†å¼‚å¸¸å€¼
        3. æ ‡å‡†åŒ–æ•°æ®æ ¼å¼
        4. æ·»åŠ å¿…è¦çš„è®¡ç®—åˆ—
        
        è¾“å‡ºæ¸…æ´—åçš„æ•°æ®è¡¨æ ¼å’Œæ¸…æ´—è¯´æ˜ã€‚
      message: æ¸…æ´—æ•°æ®
      result: Local.CleanedData
    edges:
      - targetId: show_cleaned_data

  - id: show_cleaned_data
    type: SendActivity
    properties:
      activity:
        type: message
        text: |
          ğŸ§¹ Step 2/4 - æ•°æ®æ¸…æ´—å®Œæˆ
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          ${Local.CleanedData}
    edges:
      - targetId: analyze_data

  # Step 4: æ•°æ®åˆ†æ
  - id: analyze_data
    type: InvokeAzureAgent
    properties:
      agentId: data_analyst
      instructions: |
        ä½ æ˜¯ä¸€ä¸ªèµ„æ·±æ•°æ®åˆ†æå¸ˆã€‚
        
        åˆ†æç±»å‹ï¼š${Local.AnalysisType}
        æ•°æ®ï¼š${Local.CleanedData}
        
        è¯·è¿›è¡Œæ·±å…¥åˆ†æï¼ŒåŒ…æ‹¬ï¼š
        1. å…³é”®å‘ç°ï¼ˆ3-5ä¸ªè¦ç‚¹ï¼‰
        2. ç»Ÿè®¡æŒ‡æ ‡ï¼ˆå‡å€¼ã€è¶‹åŠ¿ã€å æ¯”ç­‰ï¼‰
        3. æ´å¯Ÿå’Œç»“è®º
        4. å»ºè®®è¡ŒåŠ¨é¡¹
        
        ä½¿ç”¨ç»“æ„åŒ–çš„æ ¼å¼è¾“å‡ºã€‚
      message: åˆ†ææ•°æ®
      result: Local.AnalysisResult
    edges:
      - targetId: show_analysis

  - id: show_analysis
    type: SendActivity
    properties:
      activity:
        type: message
        text: |
          ğŸ“ˆ Step 3/4 - æ•°æ®åˆ†æå®Œæˆ
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          ${Local.AnalysisResult}
    edges:
      - targetId: suggest_visualization

  # Step 5: å¯è§†åŒ–å»ºè®®
  - id: suggest_visualization
    type: InvokeAzureAgent
    properties:
      agentId: viz_expert
      instructions: |
        ä½ æ˜¯ä¸€ä¸ªæ•°æ®å¯è§†åŒ–ä¸“å®¶ã€‚
        
        åŸºäºä»¥ä¸‹åˆ†æç»“æœï¼Œæä¾›å¯è§†åŒ–å»ºè®®ï¼š
        ${Local.AnalysisResult}
        
        è¯·æ¨èï¼š
        1. 3-5ç§åˆé€‚çš„å›¾è¡¨ç±»å‹
        2. æ¯ç§å›¾è¡¨çš„ç”¨é€”è¯´æ˜
        3. æ•°æ®ä¸å›¾è¡¨çš„æ˜ å°„å»ºè®®
        4. é…è‰²å’Œå¸ƒå±€å»ºè®®
        
        ä½¿ç”¨è¡¨æ ¼æˆ–åˆ—è¡¨æ ¼å¼è¾“å‡ºã€‚
      message: æä¾›å¯è§†åŒ–å»ºè®®
      result: Local.Visualization
    edges:
      - targetId: show_visualization

  - id: show_visualization
    type: SendActivity
    properties:
      activity:
        type: message
        text: |
          ğŸ¨ Step 4/4 - å¯è§†åŒ–å»ºè®®
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          ${Local.Visualization}
    edges:
      - targetId: generate_report

  # Step 6: ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
  - id: generate_report
    type: InvokeAzureAgent
    properties:
      agentId: report_writer
      instructions: |
        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ¥å‘Šæ’°å†™ä¸“å®¶ã€‚
        
        è¯·åŸºäºä»¥ä¸‹å†…å®¹ç”Ÿæˆä¸€ä»½å®Œæ•´çš„åˆ†ææŠ¥å‘Šï¼š
        
        ã€æ•°æ®æºã€‘${Local.DataSource}
        ã€åˆ†æç±»å‹ã€‘${Local.AnalysisType}
        ã€åˆ†æç»“æœã€‘${Local.AnalysisResult}
        ã€å¯è§†åŒ–å»ºè®®ã€‘${Local.Visualization}
        
        æŠ¥å‘Šç»“æ„ï¼š
        1. æ‰§è¡Œæ‘˜è¦ï¼ˆ100å­—ä»¥å†…ï¼‰
        2. æ ¸å¿ƒå‘ç°
        3. è¯¦ç»†åˆ†æ
        4. å»ºè®®ä¸è¡ŒåŠ¨é¡¹
        5. é™„å½•ï¼šå¯è§†åŒ–æ–¹æ¡ˆ
        
        ä½¿ç”¨ä¸“ä¸šçš„å•†ä¸šæŠ¥å‘Šé£æ ¼ã€‚
      message: ç”Ÿæˆåˆ†ææŠ¥å‘Š
      result: Local.FinalReport
    edges:
      - targetId: output_report

  # è¾“å‡ºæœ€ç»ˆæŠ¥å‘Š
  - id: output_report
    type: SendActivity
    properties:
      activity:
        type: message
        text: |
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          ğŸ“‹ æ•°æ®åˆ†ææŠ¥å‘Š
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ${Local.FinalReport}
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          âœ… åˆ†ææµç¨‹å·²å®Œæˆï¼
          å¦‚éœ€å¯¼å‡ºæŠ¥å‘Šï¼Œè¯·å¤åˆ¶ä»¥ä¸Šå†…å®¹ã€‚
